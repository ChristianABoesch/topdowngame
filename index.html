<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Top-Down Game</title>
    <style>
        body { 
            margin: 0; 
            overflow: hidden; 
            background-color: gainsboro;
            /* background-image: url('path/to/your/tile-image.png'); /* Add your tile image path */
            /* background-repeat: repeat; /* Repeat the background image */
        }
        canvas { 
            background-color: azure; /* Make canvas background transparent */
            display: block; 
            margin: auto; 
        }
    </style>
</head>
<body>
    <canvas id="gameCanvas" width="800" height="600"></canvas>
    <audio id="coinSound" src="audio/coin.wav" preload="auto"></audio> <!-- Add audio element -->
    <audio id="backgroundMusic" src="audio/topdowngame_musicloop1_updated.wav" preload="auto" loop></audio> <!-- Background music element -->
    <button id="startButton">Start Game</button> <!-- Add start button -->
    <script>
        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');

        let player = { x: 400, y: 300, size: 20, speed: 2 }; // Initial player size

        let keys = {};
        let coins = []; // Array to hold coin objects
        let coinGrowth = 5; // Amount to grow the player size per coin
        const coinSound = document.getElementById('coinSound'); // Get the audio element
        const backgroundMusic = document.getElementById('backgroundMusic'); // Get the background music element

        let gameStarted = false; // Track if the game has started
        let playerSpeed = 1; // Increased speed for smoother movement

        // Create a new image object for the coin
        const coinImage = new Image(); // Create a new image object
        coinImage.src = 'images/coin.jpeg'; // Set the source of the coin image

        // Create a new image object for hazards
        const hazardImage = new Image(); // Create a new image object for hazards
        hazardImage.src = 'images/hazard.jpeg'; // Set the source of the hazard image
        let hazards = []; // Array to hold hazard objects

        // Function to create coins
        function createCoins(numCoins) {
            for (let i = 0; i < numCoins; i++) {
                coins.push({
                    x: Math.random() * (canvas.width - 20), // Random x position
                    y: Math.random() * (canvas.height - 20), // Random y position
                    size: 20 // Coin size
                });
            }
        }

        // Function to create hazards
        function createHazards(numHazards) {
            for (let i = 0; i < numHazards; i++) {
                hazards.push({
                    x: Math.random() * (canvas.width - 20), // Random x position
                    y: Math.random() * (canvas.height - 20), // Random y position
                    size: 20 // Hazard size
                });
            }
        }

        // Update the update function to draw hazards
        function update() {
            // Clear the canvas
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            
            movePlayer(); // Call movePlayer to update position based on keys

            // Draw the player
            ctx.fillStyle = player.color; // Use the player's color
            ctx.fillRect(player.x, player.y, player.size, player.size);

            // Draw coins and check for collection
            coins.forEach((coin, index) => {
                ctx.drawImage(coinImage, coin.x, coin.y, coin.size, coin.size); // Draw the coin image
                // Check for collision
                if (player.x < coin.x + coin.size &&
                    player.x + player.size > coin.x &&
                    player.y < coin.y + coin.size &&
                    player.y + player.size > coin.y) {
                    coins.splice(index, 1); // Remove coin if collected
                    player.size += coinGrowth; // Increase player size by coinGrowth
                    coinSound.currentTime = 0; // Reset sound to start
                    coinSound.play(); // Play coin collection sound
                }
            });

            // Draw hazards
            hazards.forEach(hazard => {
                ctx.drawImage(hazardImage, hazard.x, hazard.y, hazard.size, hazard.size); // Draw the hazard image
            });

            // Clear hazards if all coins are collected
            if (coins.length === 0) {
                hazards = []; // Clear the hazards array
                player.size += 0.5; // Increase size faster (changed from 0.1 to 0.5)
            }

            // Check if player fills the canvas
            if (player.size >= canvas.width && player.size >= canvas.height) {
                resetGame(); // Call the reset function
            }
        }

        function movePlayer() {
            if (!gameStarted) return; // Prevent movement if game hasn't started

            // Example movement logic:
            if (keys['ArrowUp'] && player.y > 0) player.y -= playerSpeed;
            if (keys['ArrowDown'] && player.y < canvas.height - player.size) player.y += playerSpeed;
            if (keys['ArrowLeft'] && player.x > 0) player.x -= playerSpeed;
            if (keys['ArrowRight'] && player.x < canvas.width - player.size) player.x += playerSpeed;
        }

        function gameLoop() {
            update();
            requestAnimationFrame(gameLoop);
        }

        function startGame() {
            gameStarted = true; // Set game as started
            backgroundMusic.play(); // Play background music when the start button is pressed
            const startButton = document.getElementById('startButton');
            startButton.style.display = 'none'; // Hide the start button

            // Create a heart element
            const heart = document.createElement('div');
            heart.innerHTML = '❤️'; // Use a heart emoji
            heart.style.position = 'absolute';
            heart.style.top = startButton.offsetTop + 'px'; // Position it at the same top as the button
            heart.style.left = startButton.offsetLeft + 'px'; // Position it at the same left as the button
            heart.style.fontSize = '30px'; // Set the size of the heart
            document.body.appendChild(heart); // Add the heart to the body

            gameLoop(); // Start the game loop
        }

        // Add event listener for the start button
        document.getElementById('startButton').addEventListener('click', startGame);

        // Add event listener for keydown to track keys
        document.addEventListener('keydown', (event) => {
            keys[event.key] = true; // Track key states
        });
        document.addEventListener('keyup', (event) => {
            keys[event.key] = false; // Reset key states
        });

        createCoins(10); // Create 10 coins
        createHazards(2); // Create 2 new hazards
        gameLoop();

        let totalCoins = 10; // Initialize total coins
        let totalHazards = 2; // Initialize total hazards

        function resetGame() {
            player.size = 20; // Reset player size
            player.x = 400; // Reset player x position
            player.y = 300; // Reset player y position
            coins = []; // Clear the coins array
            hazards = []; // Clear the hazards array
            totalCoins += 5; // Increase total coins by 5
            totalHazards += 2; // Increase total hazards by 2
            createCoins(totalCoins); // Create coins based on totalCoins
            createHazards(totalHazards); // Create 2 new hazards
            player.color = '#' + Math.floor(Math.random()*16777215).toString(16); // Set player color to a random color
            
            // Change canvas color to player's last color
            ctx.fillStyle = player.color; // Set fill style to player's color
            ctx.fillRect(0, 0, canvas.width, canvas.height); // Fill the canvas with the player's color
        }
    </script>
</body>
</html>
